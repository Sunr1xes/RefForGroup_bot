# RefForGroup_bot

## Описание
RefForGroup_bot — это бот на Python, предназначенный для автоматизации задач, связанных с реферальной системой, взаимодействием с пользователями и их профилями, а также для управления выводом средств. Он поддерживает различные сценарии взаимодействия через команды и кнопки, такие как регистрация, выбор банка для вывода средств, и управление профилем пользователя.

## Функциональные возможности
- Реферальная система:
  Бот предоставляет функции для управления реферальными ссылками, отслеживания приглашенных пользователей и подсчета бонусов за рефералов.
- Регистрация пользователей:
  Бот обрабатывает регистрацию пользователей, сохраняя информацию в базе данных, и использует эту информацию для дальнейших операций.
- Управление профилем:
  Пользователи могут просматривать и редактировать данные своего профиля, включая выбор банка и способа вывода средств.
- Вывод средств:
  Бот поддерживает выбор различных банков и методов вывода средств, таких как моментальный вывод или вывод в течение 48 часов.
- Административное меню:
  Администраторы могут использовать специальные функции для управления ботом и взаимодействия с базой данных пользователей.
- Проверка пользователей на членство в чате:
  Если пользователь не состоит в чате, то пользователю нельзя пользоваться ботом, до входа в чат.
  
## Установка

1. Клонируйте репозиторий:
    ```bash
    git clone https://github.com/surixes/RefForGroup_bot.git
    ```

2. Перейдите в директорию проекта:
    ```bash
    cd RefForGroup_bot
    ```

3. Установите необходимые зависимости:
    ```bash
    pip install -r requirements.txt
    ```

## Использование

1. Запустите бота с помощью следующей команды:
    ```bash
    python bot_work.py
    ```

2. После запуска бот будет доступен для выполнения следующих команд:
   - `/start`: Команда для начала работы с ботом, отправляет приветственное сообщение и предлагает пользователю пройти регистрацию.
   - `/help`: Команда для отображения списка доступных команд и их краткого описания.
   - `/admin_menu`: Команда для отобрадения административного меню, где идет проверка телеграм id пользователя на то, имеет ли пользователь данные права или нет.

## Конфигурация

Для работы бота необходимо настроить следующие параметры:
- **TOKEN**: Токен API вашего бота в Telegram. Вы можете получить его у BotFather.
- **DATABASE_URL**: URL для подключения к базе данных, где хранятся профили пользователей, информация о рефералах и другие данные.
- **ADMINS**: Список Telegram ID администраторов, которые могут использовать специальные функции бота.

Создайте файл `.env` в корне проекта и добавьте туда следующие данные:
```bash
TOKEN=<ваш_токен_бота>
DATABASE_URL=<ваш_адрес_базы_данных>
ADMINS=<список_администраторов>
GROUP_ID=<id чата в котором будет состоять бот>
```

**Интеграция с Google Forms через Google Sheets API**
Бот использует Google Forms для автоматического сбора данных и работы с Google Sheets, откуда происходит обработка данных. Для полноценного использования этой функции необходимо настроить доступ к Google Sheets API и предоставить боту соответствующие разрешения.

**Шаги для настройки Google Sheets API**:
- Перейдите в Google Cloud Console.
- Войдите в свою учетную запись Google.
- Создайте новый проект или выберите существующий:
- Нажмите на значок проекта в верхнем левом углу.
- Выберите "Создать проект", укажите имя проекта и сохраните его.
- В меню слева выберите "APIs & Services" > "Library".
- Найдите и включите Google Sheets API.
- Перейдите в раздел "Credentials" (Учетные данные).
- Нажмите "Create Credentials" и выберите "Service Account" (сервисный аккаунт).
- Введите название и описание сервисного аккаунта, а затем выберите роль "Editor" (редактор) для доступа к Google Sheets.
- После создания сервисного аккаунта загрузите файл ключа (в формате JSON).
- Добавьте этот сервисный аккаунт в качестве пользователя с правом редактирования в Google Sheets, который вы хотите использовать:
    Откройте нужную таблицу Google Sheets.
    Нажмите "Поделиться" и введите адрес электронной почты, связанный с сервисным аккаунтом.
  
**Интеграция с проектом**:
- Переместите скачанный JSON-файл ключа сервисного аккаунта в корневую директорию проекта.
- Убедитесь, что в коде правильно используется этот ключ для авторизации:
```Python
import gspread
from oauth2client.service_account import ServiceAccountCredentials

# Авторизация с использованием ключа сервисного аккаунта
scope = ["https://spreadsheets.google.com/feeds", "https://www.googleapis.com/auth/drive"]
creds = ServiceAccountCredentials.from_json_keyfile_name("path_to_your_json_key_file.json", scope)
client = gspread.authorize(creds)

# Открытие Google Sheet по URL
sheet = client.open_by_url(doc_url)
worksheet = sheet.get_worksheet(0)
rows = worksheet.get_all_records()
```
