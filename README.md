# RefForGroup_bot

## Оглавление
- [Описание](#Описание)
- [Функциональные возможности](#Функциональные-возможности)
- [Установка](#Установка)
- [Использование](#Использование)
- [Конфигурация](#Конфигурация)
- [Интеграция с Google Sheets API](#Интеграция-с-Google-Sheets-API)
- [Вклад](#Вклад)
- [Лицензия](#Лицензия)


## Описание
RefForGroup_bot — это бот на Python, предназначенный для автоматизации задач, связанных с реферальной системой, взаимодействием с пользователями и их профилями, а также для управления выводом средств. Он поддерживает различные сценарии взаимодействия через команды и кнопки, такие как регистрация, выбор банка для вывода средств, и управление профилем пользователя.

## Функциональные возможности
- Реферальная система:
  Бот предоставляет функции для управления реферальными ссылками, отслеживания приглашенных пользователей и подсчета бонусов за рефералов.
  ```python
  @dp.message_handler(commands=['referral'])
  async def referral_info(message: types.Message):
      # Логика получения информации о реферальной системе
      await message.reply("Ваша реферальная ссылка: ...")
  ```

- Регистрация пользователей:
  Бот обрабатывает регистрацию пользователей, сохраняя информацию в базе данных, и использует эту информацию для дальнейших операций.
  ```python
  @dp.message_handler(commands=['start'])
  async def send_welcome(message: types.Message):
      await message.reply("Привет! Я помогу тебе начать работу. Пожалуйста, зарегистрируйся.")
  ```

- Управление профилем:
  Пользователи могут просматривать и редактировать данные своего профиля, включая выбор банка и способа вывода средств.

- Вывод средств:
  Бот поддерживает выбор различных банков и методов вывода средств, таких как моментальный вывод или вывод в течение 48 часов.

- Административное меню:
  Администраторы могут использовать специальные функции для управления ботом и взаимодействия с базой данных пользователей.
  ```python
  @dp.message_handler(commands=['admin_menu'])
  async def admin_menu(message: types.Message):
      if message.from_user.id in ADMINS:
          await message.reply("Добро пожаловать в административное меню.")
      else:
          await message.reply("У вас нет прав для доступа к этому меню.")
  ```

- Проверка пользователей на членство в чате:
  Если пользователь не состоит в чате, то пользователю нельзя пользоваться ботом, до входа в чат.

## Установка

1. Клонируйте репозиторий:
    ```bash
    git clone https://github.com/surixes/RefForGroup_bot.git
    ```

2. Перейдите в директорию проекта:
    ```bash
    cd RefForGroup_bot
    ```

3. Создайте виртуальное окружение и активируйте его:
    ```bash
    # Создайте виртуальное окружение
    python -m venv venv

    # Активируйте виртуальное окружение
    # Windows
    venv\Scripts\activate
    # Linux / macOS
    source venv/bin/activate
    ```

4. Установите необходимые зависимости:
    ```bash
    pip install -r requirements.txt
    ```

## Использование

1. Запустите бота с помощью следующей команды:
    ```bash
    python bot_work.py
    ```

2. После запуска бот будет доступен для выполнения следующих команд:
   - `/start`: Команда для начала работы с ботом, отправляет приветственное сообщение и предлагает пользователю пройти регистрацию.
   - `/help`: Команда для отображения списка доступных команд и их краткого описания.
   - `/admin_menu`: Команда для отображения административного меню, где идет проверка телеграм id пользователя на то, имеет ли пользователь данные права или нет.

## Конфигурация

Для работы бота необходимо настроить следующие параметры:

| Параметр       | Описание                                    | Пример значения          |
|----------------|--------------------------------------------|--------------------------|
| `TOKEN`        | Токен API вашего бота в Telegram           | `123456789:ABC-DEF1234ghIkl-zyx57W2v1u123ew11` |
| `DATABASE_URL` | URL для подключения к базе данных          | `postgresql://user:password@localhost:5432/mydb` |
| `ADMINS`       | Список Telegram ID администраторов         | `123456789,987654321`    |
| `GROUP_ID`     | ID чата, в котором будет состоять бот      | `-1234567890`            |

Создайте файл `.env` в корне проекта и добавьте туда следующие данные:
```bash
TOKEN=<ваш_токен_бота>
DATABASE_URL=<ваш_адрес_базы_данных>
ADMINS=<список_администраторов>
GROUP_ID=<id чата в котором будет состоять бот>
```

## Интеграция с Google Sheets API

Бот использует Google Forms для автоматического сбора данных и работы с Google Sheets, откуда происходит обработка данных. Для полноценного использования этой функции необходимо настроить доступ к Google Sheets API и предоставить боту соответствующие разрешения.

**Шаги для настройки Google Sheets API**:
- Перейдите в Google Cloud Console.
- Войдите в свою учетную запись Google.
- Создайте новый проект или выберите существующий:
  - Нажмите на значок проекта в верхнем левом углу.
  - Выберите "Создать проект", укажите имя проекта и сохраните его.
- В меню слева выберите "APIs & Services" > "Library".
- Найдите и включите Google Sheets API.
- Перейдите в раздел "Credentials" (Учетные данные).
- Нажмите "Create Credentials" и выберите "Service Account" (сервисный аккаунт).
- Введите название и описание сервисного аккаунта, а затем выберите роль "Editor" (редактор) для доступа к Google Sheets.
- После создания сервисного аккаунта загрузите файл ключа (в формате JSON).
- Добавьте этот сервисный аккаунт в качестве пользователя с правом редактирования в Google Sheets, который вы хотите использовать:
  - Откройте нужную таблицу Google Sheets.
  - Нажмите "Поделиться" и введите адрес электронной почты, связанный с сервисным аккаунтом.

**Интеграция с проектом**:
- Переместите скачанный JSON-файл ключа сервисного аккаунта в корневую директорию проекта.
- Убедитесь, что в коде правильно используется этот ключ для авторизации:

```python
import gspread
from oauth2client.service_account import ServiceAccountCredentials

# Авторизация с использованием ключа сервисного аккаунта
scope = ["https://spreadsheets.google.com/feeds", "https://www.googleapis.com/auth/drive"]
creds = ServiceAccountCredentials.from_json_keyfile_name("service_account_key.json", scope)
client = gspread.authorize(creds)

# Открытие Google Sheet по URL
doc_url = "https://docs.google.com/spreadsheets/d/your_spreadsheet_id/edit"
sheet = client.open_by_url(doc_url)
worksheet = sheet.get_worksheet(0)
rows = worksheet.get_all_records()

# Пример вывода данных
for row in rows:
    print(row)
```

## Вклад

1. Форкните репозиторий.
2. Создайте свою ветку (`git checkout -b feature/AmazingFeature`).
3. Закоммитьте изменения (`git commit -m 'Add some AmazingFeature'`).
4. Запушьте в ветку (`git push origin feature/AmazingFeature`).
5. Откройте Pull Request.

## Лицензия

Этот проект лицензирован под лицензией MIT, что означает, что вы можете свободно использовать, копировать, изменять и распространять его с условием указания авторства. Подробнее см. в файле [LICENSE](LICENSE).
